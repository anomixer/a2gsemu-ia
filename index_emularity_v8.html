<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple IIgs ç·šä¸Šæ¨¡æ“¬å™¨ v8 (Backend Proxy)</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background: #1a1a1a;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 3px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .branch-badge {
            position: absolute;
            top: 15px;
            right: 20px;
            background: #FFD700;
            color: #000;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .header h1 {
            color: #4CAF50;
            font-size: 24px;
            text-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: #888;
            font-size: 12px;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            min-width: 200px;
            max-width: 400px;
            background: #2a2a2a;
            border-right: 3px solid #4CAF50;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            font-size: 14px;
            background: #1a1a1a;
            border: none;
            border-bottom: 2px solid #444;
            color: #fff;
            outline: none;
        }

        .search-box:focus {
            border-bottom-color: #4CAF50;
        }

        .game-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .game-list::-webkit-scrollbar {
            width: 8px;
        }

        .game-list::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .game-list::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        .game-item {
            background: #333;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .game-item:hover {
            background: #3a3a3a;
            border-color: #4CAF50;
            transform: translateX(5px);
        }

        .game-item.active {
            background: #4CAF50;
            color: #000;
            border-color: #4CAF50;
        }

        .game-item h3 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .game-item .name-en {
            font-size: 12px;
            color: #aaa;
            font-weight: normal;
        }

        .game-item.active .name-en {
            color: #333;
        }

        .game-item .year {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .game-item.active .year {
            color: #222;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }

        .badge-game {
            background: #2196F3;
            color: #fff;
        }

        .badge-edu {
            background: #FF9800;
            color: #fff;
        }

        .badge-tool {
            background: #9C27B0;
            color: #fff;
        }

        .badge-special {
            background: #E91E63;
            color: #fff;
        }

        .resizer {
            width: 5px;
            background: #4CAF50;
            cursor: col-resize;
            position: relative;
            flex-shrink: 0;
        }

        .resizer:hover {
            background: #45a049;
            width: 8px;
        }

        .resizer::after {
            content: 'â‹®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-size: 20px;
            font-weight: bold;
        }

        .emulator-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
            position: relative;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
        }

        .welcome-screen h2 {
            color: #4CAF50;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .welcome-screen p {
            color: #888;
            font-size: 18px;
            max-width: 500px;
            line-height: 1.6;
        }

        .emulator-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .emulator-container.active {
            display: flex;
        }

        .emulator-controls {
            background: #2a2a2a;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #4CAF50;
        }

        .game-title-bar {
            flex: 1;
            color: #4CAF50;
            font-weight: bold;
            font-size: 16px;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            background: #4CAF50;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #666;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #777;
        }

        .btn-archive {
            background: #2196F3;
            color: #fff;
        }

        .btn-archive:hover {
            background: #1976D2;
        }

        .emulator-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .iframe-wrapper {
            flex: 1;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            background: #000;
            padding: 10px;
            position: relative;
            overflow: auto;
            min-height: 0;
        }

        #canvas {
            display: block;
            margin: 0 auto;
            min-width: 640px;
            min-height: 480px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background: #000;
            cursor: pointer;
        }

        .info-panel {
            width: 280px;
            min-width: 200px;
            max-width: 400px;
            background: #1a1a1a;
            border-left: 2px solid #4CAF50;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 3px;
        }

        .info-section {
            margin-bottom: 25px;
        }

        .info-section h3 {
            color: #4CAF50;
            font-size: 16px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #333;
        }

        .info-section p {
            color: #aaa;
            line-height: 1.6;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .info-section ul {
            list-style: none;
            padding: 0;
        }

        .info-section li {
            color: #ccc;
            padding: 6px 0;
            font-size: 13px;
            border-bottom: 1px solid #2a2a2a;
        }

        .info-section li:last-child {
            border-bottom: none;
        }

        .game-info-box {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 3px solid #2196F3;
        }

        .key-combo {
            display: inline-block;
            background: #333;
            color: #4CAF50;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            margin: 0 3px;
            border: 1px solid #4CAF50;
        }

        .mame-section {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #FF9800;
        }

        .mame-section h4 {
            color: #FF9800;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .mame-section ul {
            margin-top: 8px;
        }

        .mame-section li {
            font-size: 12px;
            line-height: 1.5;
            color: #ddd;
        }

        .sound-tip {
            background: #2196F3;
            color: #fff;
            padding: 10px 15px;
            text-align: center;
            font-size: 12px;
            border-bottom: 2px solid #1976D2;
        }

        .sound-tip strong {
            color: #fff;
        }

        .highlight {
            color: #4CAF50;
            font-weight: bold;
        }

        @media (max-width: 1200px) {
            .info-panel {
                width: 280px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 40%;
                border-right: none;
                border-bottom: 3px solid #4CAF50;
            }

            .resizer {
                display: none;
            }

            .emulator-area {
                height: 60%;
            }

            .info-panel {
                display: none;
            }
        }

        .sidebar {
            width: 320px;
            background: #2a2a2a;
            border-right: 3px solid #4CAF50;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            font-size: 14px;
            background: #1a1a1a;
            border: none;
            border-bottom: 2px solid #444;
            color: #fff;
            outline: none;
        }

        .search-box:focus {
            border-bottom-color: #4CAF50;
        }

        .game-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .game-list::-webkit-scrollbar {
            width: 8px;
        }

        .game-list::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .game-list::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        .game-item {
            background: #333;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .game-item:hover {
            background: #3a3a3a;
            border-color: #4CAF50;
            transform: translateX(5px);
        }

        .game-item.active {
            background: #4CAF50;
            color: #000;
        }

        .game-item h3 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }

        .badge-game {
            background: #2196F3;
        }

        .emulator-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
        }

        .welcome-screen h2 {
            color: #4CAF50;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .emulator-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .emulator-container.active {
            display: flex;
        }

        .emulator-controls {
            background: #2a2a2a;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #4CAF50;
        }

        .game-title-bar {
            flex: 1;
            color: #4CAF50;
            font-weight: bold;
            font-size: 16px;
        }

        .btn {
            background: #4CAF50;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .emulator-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            padding: 20px;
            position: relative;
        }

        #canvas {
            display: block;
            width: 880px;
            height: 580px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background: #000;
            cursor: pointer;
            transform-origin: top left;
        }

        .loading-tip {
            background: #4CAF50;
            color: #000;
            padding: 10px 15px;
            text-align: center;
            font-size: 12px;
            border-bottom: 2px solid #45a049;
            font-weight: bold;
        }

        .loading-tip.hidden {
            display: none;
        }

        .usage-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(76, 175, 80, 0.95);
            color: #000;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.5);
            z-index: 1000;
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        .usage-overlay.hidden {
            display: none;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="branch-badge">â­ v8 Backend</div>
        <h1><img src="favicon.ico" alt="Apple" style="height: 24px; vertical-align: middle; margin-right: 8px;"> Apple
            IIgs ç·šä¸Šæ¨¡æ“¬å™¨ ğŸ®</h1>
        <p class="subtitle">v8 - ä½¿ç”¨å¾Œç«¯ä»£ç†ï¼Œå…± <span id="totalCount">0</span> æ¬¾ç²¾é¸éŠæˆ²èˆ‡è»Ÿé«”</p>
    </div>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <input type="text" class="search-box" id="searchBox" placeholder="ğŸ” æœå°‹éŠæˆ²...">
            <div class="game-list" id="gameList"></div>
        </div>

        <div class="resizer" id="leftResizer"></div>

        <div class="emulator-area">
            <div class="welcome-screen" id="welcomeScreen">
                <h2>æ­¡è¿ä½¿ç”¨ Apple IIgs æ¨¡æ“¬å™¨</h2>
                <p>ğŸ‘ˆ è«‹å¾å·¦å´é¸æ“‡ä¸€æ¬¾éŠæˆ²æˆ–è»Ÿé«”é–‹å§‹</p>
                <p style="margin-top: 20px; font-size: 14px; color: #666;">
                    Apple IIgs æ˜¯ Apple II ç³»åˆ—çš„ç¬¬äº”ä»£ç”¢å“<br>
                    æ–¼ 1986 å¹´ç™¼å¸ƒ,æ“æœ‰ 16 ä½å…ƒè™•ç†å™¨å’Œå½©è‰²åœ–å½¢èƒ½åŠ›
                </p>
                <p style="margin-top: 20px; font-size: 14px; color: #4CAF50;">
                    â­ v8 - Backend Proxy<br>
                    â€¢ ä½¿ç”¨ Node.js å¾Œç«¯ä»£ç†<br>
                    â€¢ å®Œå…¨è§£æ±º CORS å•é¡Œ<br>
                    â€¢ ğŸ”Š è²éŸ³å®Œå…¨æ­£å¸¸ï¼<br>
                </p>
            </div>

            <div class="emulator-container" id="emulatorContainer">
                <div class="emulator-controls">
                    <div class="game-title-bar" id="gameTitleBar">è¼‰å…¥ä¸­...</div>
                    <button class="btn btn-archive sound-btn" id="archiveBtn" title="åœ¨ Archive.org é–‹å•Ÿä»¥æ§åˆ¶è²éŸ³">
                        ğŸ”Š é–‹å•Ÿè²éŸ³
                    </button>
                    <div class="control-buttons">
                        <button class="btn" id="zoomOutBtn" title="ç¸®å°">ğŸ”-</button>
                        <button class="btn" id="zoomInBtn" title="æ”¾å¤§">ğŸ”+</button>
                        <button class="btn" id="fullscreenBtn" title="å…¨è¢å¹•">â›¶ å…¨è¢å¹•</button>
                        <button class="btn btn-secondary" id="reloadBtn" title="é‡æ–°è¼‰å…¥">ğŸ”„</button>
                    </div>
                </div>


                <div class="emulator-content">
                    <div class="iframe-wrapper">
                        <div class="usage-overlay hidden" id="usageOverlay">
                            ğŸ‘† é»æ“Šç•«é¢ä¸¦æŒ‰ä»»æ„éµé–‹å§‹éŠæˆ²
                        </div>
                        <canvas id="canvas"></canvas>
                    </div>

                    <div class="resizer" id="rightResizer"></div>

                    <div class="info-panel" id="infoPanel">
                        <div class="info-section">
                            <h3>ğŸ® éŠæˆ²è³‡è¨Š</h3>
                            <div class="game-info-box">
                                <p id="gameDescription">é¸æ“‡éŠæˆ²å¾Œé¡¯ç¤ºè©³ç´°è³‡è¨Š</p>
                            </div>
                            <ul id="gameDetails"></ul>
                        </div>

                        <div class="info-section">
                            <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                            <ul>
                                <li>â±ï¸ é¦–æ¬¡è¼‰å…¥éœ€è¦ 10-30 ç§’,è«‹è€å¿ƒç­‰å¾…</li>
                                <li>ğŸ”Š è²éŸ³å®Œå…¨æ­£å¸¸ï¼ä½¿ç”¨å¾Œç«¯ä»£ç†è§£æ±º CORS</li>
                                <li>â›¶ å»ºè­°ä½¿ç”¨å…¨è¢å¹•æ¨¡å¼ä»¥ç²å¾—æœ€ä½³é«”é©—</li>
                                <li>ğŸ’¾ MAME æœƒè‡ªå‹•å„²å­˜éŠæˆ²ç‹€æ…‹åˆ°ç€è¦½å™¨</li>
                                <li>ğŸ¯ éƒ¨åˆ†éŠæˆ²æ”¯æ´æ»‘é¼ æ“ä½œ</li>
                                <li>âš¡ å¦‚éŠæˆ²éæ…¢,å¯èª¿æ•´ CPU é€Ÿåº¦åŠ å¿«</li>
                                <li>ğŸ”„ é‡åˆ°å•é¡Œå¯æŒ‰ ğŸ”„ é‡ç½®</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h3>âŒ¨ï¸ ä¸€èˆ¬æ“ä½œèªªæ˜</h3>
                            <ul>
                                <li><span class="key-combo">â†‘ â†“ â† â†’</span> æ–¹å‘éµç§»å‹•/é¸æ“‡</li>
                                <li><span class="key-combo">Space</span> å‹•ä½œ/è·³èº/å°„æ“Š</li>
                                <li><span class="key-combo">Enter</span> é–‹å§‹éŠæˆ²/ç¢ºèª</li>
                                <li><span class="key-combo">Esc</span> æš«åœ/å–æ¶ˆ</li>
                                <li><span class="key-combo">Ctrl</span> é–‹ç«/æ¬¡è¦å‹•ä½œ</li>
                                <li><span class="key-combo">Alt</span> æ›¿ä»£æŒ‰éˆ•</li>
                                <li><span class="key-combo">1-9</span> æ•¸å­—éµè¼¸å…¥</li>
                                <li><span class="key-combo">A-Z</span> å­—æ¯éµè¼¸å…¥</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h3>ğŸ® MAME æ¨¡æ“¬å™¨æ“ä½œ</h3>

                            <div class="mame-section">
                                <h4>ğŸ“‹ åŸºæœ¬æ§åˆ¶</h4>
                                <ul>
                                    <li><span class="key-combo">Scroll Lock</span> é–‹å•Ÿ/é—œé–‰ MAME UI æ¨¡å¼</li>
                                    <li><span class="key-combo">Tab</span> é–‹å•Ÿ MAME é¸å–®</li>
                                    <li><span class="key-combo">~</span> (æ³¢æµªè™Ÿ) å¿«é€Ÿé¸å–®</li>
                                    <li><span class="key-combo">P</span> æš«åœæ¨¡æ“¬å™¨</li>
                                    <li><span class="key-combo">F4</span> é¡¯ç¤ºèª¿è‰²ç›¤</li>
                                    <li><span class="key-combo">F8</span> é™ä½å¹€ç‡è·³é</li>
                                    <li><span class="key-combo">F9</span> æé«˜å¹€ç‡è·³é</li>
                                </ul>
                            </div>

                            <div class="mame-section">
                                <h4>âš™ï¸ Machine Configuration</h4>
                                <p style="font-size:12px; color:#ddd; margin-bottom:8px;">
                                    å…ˆæŒ‰ <span class="key-combo">Scroll Lock</span> é–‹å•Ÿ UI â†’ å†æŒ‰ <span
                                        class="key-combo">Tab</span> â†’ é¸æ“‡ <span class="highlight">Machine
                                        Configuration</span>
                                </p>
                                <ul>
                                    <li><strong>CPU Speed:</strong> èª¿æ•´ CPU åŸ·è¡Œé€Ÿåº¦
                                        <br><small style="color:#888;">å¯åŠ é€Ÿæ…¢é€ŸéŠæˆ²æˆ–æ¸›é€Ÿéå¿«éŠæˆ²</small>
                                    </li>
                                    <li><strong>Video Options:</strong> è¦–è¨Šè¨­å®š
                                        <br><small style="color:#888;">èª¿æ•´ç•«é¢å¤§å°ã€æ¿¾é¡æ•ˆæœ</small>
                                    </li>
                                    <li><strong>Audio Options:</strong> éŸ³è¨Šè¨­å®š
                                        <br><small style="color:#888;">éŸ³é‡ã€å–æ¨£ç‡èª¿æ•´</small>
                                    </li>
                                    <li><strong>Input Settings:</strong> è¼¸å…¥è¨­å®š
                                        <br><small style="color:#888;">è‡ªè¨‚æŒ‰éµé…ç½®</small>
                                    </li>
                                </ul>
                            </div>

                            <div class="mame-section">
                                <h4>ğŸ’¾ å­˜æª”/è®€æª”</h4>
                                <ul>
                                    <li><span class="key-combo">Shift+F7</span> å­˜æª”åˆ°ç•¶å‰æ§½ä½</li>
                                    <li><span class="key-combo">F7</span> å¾ç•¶å‰æ§½ä½è®€æª”</li>
                                    <li>æ”¯æ´å¤šå€‹å­˜æª”æ§½ä½ (0-9)</li>
                                </ul>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3>â„¹ï¸ é—œæ–¼ Apple IIgs</h3>
                            <p>Apple IIgs æ˜¯ Apple Computer æ–¼ 1986 å¹´ 9 æœˆæ¨å‡ºçš„ 16 ä½å…ƒå€‹äººé›»è…¦,æ˜¯ Apple II ç³»åˆ—çš„æœ€å¾Œä¸€æ¬¾ç”¢å“ã€‚</p>
                            <p><strong>ä¸»è¦è¦æ ¼:</strong></p>
                            <ul>
                                <li>2.8 MHz çš„ 65C816 è™•ç†å™¨</li>
                                <li>256 KB RAM (å¯æ“´å……è‡³ 8 MB)</li>
                                <li>æ”¯æ´ 4096 è‰²é¡¯ç¤º</li>
                                <li>Ensoniq 5503 éŸ³æ•ˆæ™¶ç‰‡ (32 è²é“)</li>
                                <li>å‘ä¸‹ç›¸å®¹ Apple II ç³»åˆ—è»Ÿé«”</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="./browserfs.min.js"></script>
    <script src="./loader.js"></script>

    <script>
        let currentGame = null;
        let currentEmulator = null;
        let emularityReady = false;
        let isFullscreen = false;
        let isResizing = false;
        let currentZoom = 1.0;
        const SERVER_URL = window.location.origin;

        const gameList = document.getElementById('gameList');
        const searchBox = document.getElementById('searchBox');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const emulatorContainer = document.getElementById('emulatorContainer');
        const emulatorFrame = document.getElementById('canvas');
        const gameTitleBar = document.getElementById('gameTitleBar');
        const gameDescription = document.getElementById('gameDescription');
        const gameDetails = document.getElementById('gameDetails');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const archiveBtn = document.getElementById('archiveBtn');
        const reloadBtn = document.getElementById('reloadBtn');

        const sidebar = document.getElementById('sidebar');
        const infoPanel = document.getElementById('infoPanel');
        const leftResizer = document.getElementById('leftResizer');
        const rightResizer = document.getElementById('rightResizer');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');

        function getBadge(type) {
            const badges = {
                'game': '<span class="badge badge-game">éŠæˆ²</span>',
                'edu': '<span class="badge badge-edu">æ•™è‚²</span>',
                'tool': '<span class="badge badge-tool">å·¥å…·</span>',
                'special': '<span class="badge badge-special">ç‰¹åˆ¥</span>'
            };
            return badges[type] || '';
        }

        function updateCanvasZoom() {
            const canvas = document.getElementById('canvas');
            if (canvas) {
                canvas.style.transform = `scale(${currentZoom})`;
                canvas.style.transformOrigin = 'top left';
            }
        }

        zoomInBtn.onclick = () => {
            currentZoom = Math.min(currentZoom + 0.1, 2.0);
            updateCanvasZoom();
        };

        zoomOutBtn.onclick = () => {
            currentZoom = Math.max(currentZoom - 0.1, 0.5);
            updateCanvasZoom();
        };

        console.log('â­ é–‹å§‹è¼‰å…¥ Emularity v8 (Backend Proxy)...');
        console.log('   - Server URL:', SERVER_URL);

        const games = [
            // === åŸæœ‰éŠæˆ² ===
            { id: 'wozaday_Prince_of_Persia', file: 'Prince_of_Persia.2mg', name: 'æ³¢æ–¯ç‹å­', nameEn: 'Prince of Persia', year: '1989', type: 'game', desc: 'ç¶“å…¸çš„é›»å½±å¼å¹³å°å‹•ä½œéŠæˆ²ã€‚ç©å®¶æœ‰ 60 åˆ†é˜çš„æ™‚é–“ç©¿è¶Šåœ°ä¸‹åŸ,æ‹¯æ•‘è¢«å›šç¦çš„å…¬ä¸»ã€‚éŠæˆ²æ¡ç”¨é©å‘½æ€§çš„å‹•ä½œæ•æ‰æŠ€è¡“,è§’è‰²å‹•ä½œæµæš¢è‡ªç„¶ã€‚ç²¾å¿ƒè¨­è¨ˆçš„é—œå¡çµåˆè·‘é…·ã€æˆ°é¬¥å’Œè§£è¬å…ƒç´ ,æ˜¯éŠæˆ²å²ä¸Šçš„é‡Œç¨‹ç¢ä¹‹ä½œã€‚', developer: 'Jordan Mechner', publisher: 'Broderbund' },
            { id: 'wozaday_Paperboy_IIgs', file: 'Paperboy_IIgs.2mg', name: 'é€å ±ç”Ÿ', nameEn: 'Paperboy', year: '1988', type: 'game', desc: 'Atari çš„ç¶“å…¸è¡—æ©ŸéŠæˆ²ç§»æ¤ã€‚ç©å®¶æ‰®æ¼”é¨è»Šçš„é€å ±ç”Ÿ,åœ¨ä¸Šå­¸è·¯ä¸Šå°‡å ±ç´™ä¸Ÿé€²è¨‚æˆ¶çš„ä¿¡ç®±ã€‚è¦é¿é–‹å„ç¨®éšœç¤™ç‰©:æ±½è»Šã€ç‹—ã€å·¥äººã€æ»¿è‰å€æ©Ÿç­‰ã€‚éŠæˆ²å……æ»¿ç´°ç¯€å’Œå¹½é»˜,æ˜¯ 80 å¹´ä»£æœ€å—æ­¡è¿çš„å‹•ä½œéŠæˆ²ä¹‹ä¸€ã€‚', developer: 'Atari Games', publisher: 'Mindscape' },
            { id: 'wozaday_The_Immortal_IIgs', file: 'The_Immortal_IIgs.2mg', name: 'ä¸æœ½å‚³èªª', nameEn: 'The Immortal', year: '1990', type: 'game', desc: 'ä¸€æ¬¾ç­‰è·è¦–è§’çš„å‹•ä½œå†’éšªéŠæˆ²ã€‚ç©å®¶æ‰®æ¼”ä¸€åè€å·«å¸«,åœ¨å±éšªçš„åœ°ä¸‹åŸä¸­æ¢éšª,å°‹æ‰¾å¤±è¹¤çš„å°å¸«ã€‚éŠæˆ²ä»¥é«˜é›£åº¦å’Œæ®˜é…·çš„é™·é˜±èå,æ¯å€‹æˆ¿é–“éƒ½å……æ»¿è‡´å‘½çš„æŒ‘æˆ°ã€‚ç²¾ç¾çš„åœ–åƒå’Œå‹•ç•«å±•ç¾äº† Apple IIgs çš„åœ–å½¢èƒ½åŠ›ã€‚', developer: 'Will Harvey', publisher: 'Electronic Arts' },
            { id: 'wozaday_Rastan', file: 'Rastan.2mg', name: 'ç‹è€…ä¹‹åŠ', nameEn: 'Rastan', year: '1990', type: 'game', desc: 'Taito çš„æ©«å‘æ²è»¸å‹•ä½œéŠæˆ²ã€‚ç©å®¶æ‰®æ¼”é‡è »æˆ°å£« Rastan,æ®èˆå·¨åŠå°æŠ—æ€ªç‰©å’Œæƒ¡é¾ã€‚éŠæˆ²ç¯€å¥å¿«é€Ÿ,æ•µäººçœ¾å¤š,éœ€è¦ç²¾æº–çš„æ“ä½œå’Œæ™‚æ©ŸæŒæ¡ã€‚Apple IIgs ç‰ˆæœ¬ä¿ç•™äº†è¡—æ©Ÿç‰ˆçš„åˆºæ¿€æ„Ÿã€‚', developer: 'Taito', publisher: 'Taito' },
            { id: 'wozaday_Crystal_Quest_IIgs', file: 'Crystal_Quest_IIgs.2mg', name: 'æ°´æ™¶ä»»å‹™', nameEn: 'Crystal Quest', year: '1988', type: 'game', desc: 'å¿«ç¯€å¥çš„å°„æ“Šæ”¶é›†éŠæˆ²ã€‚ç©å®¶æ§åˆ¶ä¸€è‰˜å°é£›èˆ¹,åœ¨å……æ»¿æ•µäººçš„å ´æ™¯ä¸­æ”¶é›†æ°´æ™¶ã€‚éŠæˆ²ç‰¹è‰²æ˜¯360åº¦å…¨æ–¹å‘ç§»å‹•å’Œå°„æ“Š,ä»¥åŠè±å¯Œçš„æ•µäººç¨®é¡å’Œé“å…·ç³»çµ±ã€‚è‰²å½©é®®è±”çš„åœ–å½¢å’Œå‹•æ„Ÿçš„éŸ³æ•ˆè®“äººæ¬²ç½·ä¸èƒ½ã€‚', developer: 'Patrick Buckland', publisher: 'Casady & Greene' },
            { id: 'wozaday_Arkanoid_IIgs', file: 'Arkanoid_IIgs.2mg', name: 'å¿«æ‰“ç£šå¡Š', nameEn: 'Arkanoid', year: '1987', type: 'game', desc: 'Taito ç¶“å…¸çš„æ‰“ç£šå¡ŠéŠæˆ²ã€‚ç©å®¶æ§åˆ¶åº•éƒ¨çš„æ“‹æ¿,åå½ˆçƒæ‰“ç ´å½©è‰²ç£šå¡Šã€‚éŠæˆ²åŠ å…¥é“å…·ç³»çµ±,è®“ç©æ³•æ›´è±å¯Œ:é›·å°„ã€å¤šçƒã€å»¶é•·æ“‹æ¿ç­‰ã€‚é—œå¡è¨­è¨ˆç²¾å·§,ç£šå¡Šæ’åˆ—å½¢æˆå„ç¨®åœ–æ¡ˆã€‚', developer: 'Taito', publisher: 'Discovery Software' },
            { id: 'wozaday_Marble_Madness_IIgs', file: 'Marble_Madness_IIgs.2mg', name: 'é›²éœ„é£›çƒ', nameEn: 'Marble Madness', year: '1988', type: 'game', desc: 'Atari çš„ç¶“å…¸è¡—æ©ŸéŠæˆ²ã€‚ç©å®¶æ§åˆ¶å½ˆç ç©¿è¶Šå……æ»¿æ©Ÿé—œçš„ 3D ç­‰è·è¿·å®®ã€‚éŠæˆ²ç‰©ç†å¼•æ“çœŸå¯¦,å½ˆç æœƒå—é‡åŠ›å’Œæ…£æ€§å½±éŸ¿ã€‚ç²¾ç¾çš„åœ–å½¢å’Œå„ªç§€çš„éŸ³æ¨‚è®“é€™æ¬¾éŠæˆ²æˆç‚º Apple IIgs çš„æŠ€è¡“å±•ç¤ºç¯„ä¾‹ã€‚', developer: 'Atari Games', publisher: 'Electronic Arts' },

            // === å†’éšªéŠæˆ² ===
            { id: 'wozaday_Space_Quest_II_IIgs', file: '00playable.woz', file2: '00playable2.woz', name: 'å®‡å®™è‹±é›„å‚³ 2', nameEn: 'Space Quest II', year: '1988', type: 'game', desc: 'Sierra è‘—åçš„åœ–å½¢å†’éšªéŠæˆ²ç³»åˆ—ç¬¬äºŒéƒ¨ã€‚ç©å®¶æ‰®æ¼”æ¸…æ½”å·¥ Roger Wilco,åœ¨å¤–æ˜Ÿçƒä¸Šå±•é–‹æç¬‘çš„å†’éšªã€‚éŠæˆ²å……æ»¿å¹½é»˜çš„å°è©±ã€å‰µæ„åè¶³çš„è¬é¡Œå’Œè‡´å‘½çš„é™·é˜±ã€‚Apple IIgs ç‰ˆæœ¬æ“æœ‰ 16 è‰²å½©è‰²åœ–å½¢å’ŒéŸ³æ•ˆã€‚', developer: 'Sierra On-Line', publisher: 'Sierra On-Line' },
            { id: 'wozaday_The_King_of_Chicago_IIgs', file: 'The_King_of_Chicago_IIgs.2mg', name: 'èŠåŠ å“¥ä¹‹ç‹', nameEn: 'The King of Chicago', year: '1988', type: 'game', desc: 'å‰µæ–°çš„äº’å‹•å¼é›»å½±éŠæˆ²ã€‚è¨­å®šåœ¨ 1930 å¹´ä»£çš„èŠåŠ å“¥é»‘å¹«ä¸–ç•Œ,ç©å®¶æ‰®æ¼”ä¸€åé»‘å¹«è€å¤§,é€éæ±ºç­–å½±éŸ¿åŠ‡æƒ…èµ°å‘ã€‚éŠæˆ²æ¡ç”¨æ¼«ç•«é¢¨æ ¼çš„ç²¾ç¾ç•«é¢,é…åˆç·Šå¼µåˆºæ¿€çš„é…æ¨‚,æä¾›æ²‰æµ¸å¼çš„é›»å½±é«”é©—ã€‚', developer: 'Cinemaware', publisher: 'Cinemaware' },
            { id: 'wozaday_Deja_Vu_IIgs', file: 'Deja_Vu_IIgs.2mg', name: 'ä¼¼æ›¾ç›¸è­˜', nameEn: 'DÃ©jÃ  Vu', year: '1987', type: 'game', desc: 'é»æ“Šå¼å†’éšªéŠæˆ²,ä»¥é»‘è‰²é›»å½±ç‚ºé¡Œæã€‚ç©å®¶é†’ä¾†æ™‚å¤±æ†¶,å¿…é ˆåœ¨ 1940 å¹´ä»£çš„èŠåŠ å“¥èª¿æŸ¥è‡ªå·±çš„èº«åˆ†å’Œä¸€æ¨è¬€æ®ºæ¡ˆã€‚éŠæˆ²æ¡ç”¨å‰µæ–°çš„åœ–å½¢ç•Œé¢,å…è¨±ç©å®¶æª¢æŸ¥ã€æ‹¿å–å’Œä½¿ç”¨ç‰©å“ã€‚å¤§æ°£çš„é»‘ç™½ç•«é¢ç‡Ÿé€ å‡ºæ‡¸ç–‘çš„æ°›åœã€‚', developer: 'ICOM Simulations', publisher: 'Mindscape' },
            { id: 'a2gs_Tass_Times_In_Tonetown_1986_Activision', file: 'Tass_Times_In_Tonetown_1986_Activision.2mg', name: 'æ±åŸæ™‚å…‰', nameEn: 'Tass Times In Tonetown', year: '1986', type: 'game', desc: 'ç¨ç‰¹çš„åœ–å½¢å†’éšªéŠæˆ²,æ¡ç”¨è¶…ç¾å¯¦ä¸»ç¾©é¢¨æ ¼ã€‚ç©å®¶åœ¨å¥‡ç•°çš„æ±åŸä¸­æ¢éšª,å°‹æ‰¾å¤±è¹¤çš„ç¥–çˆ¶ã€‚éŠæˆ²æ“æœ‰å¡é€šèˆ¬çš„å½©è‰²åœ–å½¢å’Œè©¼è«§çš„å°è©±,æ˜¯ 80 å¹´ä»£æœ€å…·å‰µæ„çš„å†’éšªéŠæˆ²ä¹‹ä¸€ã€‚', developer: 'Interplay', publisher: 'Activision' },
            { id: 'a2gs_Shadowgate_1988_Mindscape', file: 'Shadowgate_1988_Mindscape.2mg', name: 'å½±ä¹‹é–€', nameEn: 'Shadowgate', year: '1988', type: 'game', desc: 'ç¶“å…¸çš„é»æ“Šå¼å†’éšªéŠæˆ²ã€‚ç©å®¶å¿…é ˆæ¢ç´¢é™°æ£®çš„åŸå ¡,è§£é–‹è¬é¡Œä¸¦é¿é–‹è‡´å‘½é™·é˜±,é˜»æ­¢é‚ªæƒ¡è¡“å£«çš„é™°è¬€ã€‚éŠæˆ²ä»¥é«˜é›£åº¦å’Œå¤šç¨®æ­»äº¡æ–¹å¼èå,ç‡Ÿé€ å‡ºç·Šå¼µææ€–çš„æ°£æ°›ã€‚', developer: 'ICOM Simulations', publisher: 'Mindscape' },

            // === è§’è‰²æ‰®æ¼”éŠæˆ² ===
            { id: 'wozaday_The_Bards_Tale_IIgs', file: 'The_Bards_Tale_IIgs.2mg', name: 'å†°åŸå‚³å¥‡', nameEn: "The Bard's Tale", year: '1987', type: 'game', desc: 'ç¬¬ä¸€äººç¨±è¦–è§’çš„è§’è‰²æ‰®æ¼”éŠæˆ²ã€‚çµ„å»ºä¸€æ”¯ 6 äººå†’éšªéšŠ,åœ¨è¢«å†°é›ªå°å°çš„ Skara Brae åŸå¸‚æ¢éšªã€‚éŠæˆ²åŒ…å«è±å¯Œçš„è·æ¥­ç³»çµ±ã€é­”æ³•ç³»çµ±å’Œæˆ°é¬¥æ©Ÿåˆ¶ã€‚Apple IIgs ç‰ˆæœ¬æ“æœ‰å¢å¼·çš„éŸ³æ•ˆå’Œåœ–å½¢,æ˜¯ RPG æ„›å¥½è€…çš„å¿…ç©ä¹‹ä½œã€‚', developer: 'Interplay', publisher: 'Electronic Arts' },
            { id: 'wozaday_Ultima_III_IIgs', file: '00playable.woz', file2: '00playable2.woz', name: 'å‚³å¥‡3', nameEn: 'Ultima III: Exodus', year: '1987', type: 'game', desc: 'ç¶“å…¸è§’è‰²æ‰®æ¼”éŠæˆ²ï¼ŒApple IIgs å¢å¼·ç‰ˆã€‚çµ„å»ºéšŠä¼å†’éšªã€‚RPG ç¶“å…¸ã€‚çµ„å»ºéšŠä¼å†’éšªã€‚', developer: 'Origin Systems', publisher: 'FCI' },
            { id: 'wozaday_Wizardry_IIgs', file: '00playable.woz', name: 'å·«è¡“å‚³å¥‡', nameEn: 'Wizardry', year: '1987', type: 'game', desc: 'åœ°åŸæ¢éšª RPGã€‚ç¬¬ä¸€äººç¨±è¦–è§’ã€‚', developer: 'Sir-tech', publisher: 'Doshin' },

            // === é‹å‹•éŠæˆ² ===
            { id: 'wozaday_Hardball_IIgs', file: '00playable.woz', name: 'ç¡¬å¼æ£’çƒ', nameEn: 'Hardball!', year: '1987', type: 'game', desc: 'é€¼çœŸçš„æ£’çƒéŠæˆ²ã€‚çœŸå¯¦çš„æŠ•çƒã€æ‰“æ“Šå’Œå®ˆå‚™ç³»çµ±ã€‚', developer: 'Accolade', publisher: 'Accolade' },
            { id: 'wozaday_Mean_18_IIgs', file: '00playable.woz', name: 'å‡ç·šé«˜çˆ¾å¤«', nameEn: 'Mean 18 Golf', year: '1987', type: 'game', desc: 'é«˜çˆ¾å¤«éŠæˆ²ã€‚çœŸå¯¦çš„çƒç‰©ç†å’Œçƒå ´è¨­è¨ˆã€‚', developer: 'Accolade', publisher: 'Accolade' },
            { id: 'wozaday_Winter_Games_IIgs', file: '00playable.woz', name: 'å†¬å­£é‹å‹•æœƒ', nameEn: 'Winter Games', year: '1987', type: 'game', desc: 'å†¬å­£å¥§é‹é …ç›®éŠæˆ²åˆé›†ã€‚7 ç¨®å†¬å­£é‹å‹•ã€‚', developer: 'Epyx', publisher: 'Epyx' },
            { id: 'wozaday_California_Games_IIgs', file: '00playable.woz', name: 'åŠ å·é‹å‹•æœƒ', nameEn: 'California Games', year: '1989', type: 'game', desc: 'æ¥µé™é‹å‹•éŠæˆ²åˆé›†ã€‚è¡æµªã€æ»‘æ¿ç­‰åŠ å·ç‰¹è‰²é‹å‹•ã€‚', developer: 'Epyx', publisher: 'Epyx' },
            { id: 'a2gs_World_Games_1987_Epyx', file: 'World_Games_1987_Epyx.2mg', name: 'ä¸–ç•Œé‹å‹•æœƒ', nameEn: 'World Games', year: '1987', type: 'game', desc: 'å…¨çƒç‰¹è‰²é‹å‹•åˆé›†ã€‚åŒ…å« 8 ç¨®ç•°åœ‹é‹å‹•ã€‚', developer: 'Epyx', publisher: 'Epyx' },
            { id: 'a2gs_Zany_golf_1988_Electronic_Arts', file: 'Zany_golf_1988_Electronic_Arts.2mg', name: 'ç˜‹ç‹‚é«˜çˆ¾å¤«', nameEn: 'Zany Golf', year: '1988', type: 'game', desc: 'å‰µæ„åè¶³çš„è¿·ä½ é«˜çˆ¾å¤«éŠæˆ²ã€‚9 å€‹æ´è¨­è¨ˆæ¥µå…·æƒ³åƒåŠ›,åŒ…å«å½ˆç°§ã€å‚³é€é–€å’Œç§»å‹•éšœç¤™ç‰©ã€‚', developer: 'Sandcastle', publisher: 'Electronic Arts' },

            // === ç›Šæ™ºéŠæˆ² ===
            { id: 'wozaday_Shanghai_IIgs', file: '00playable.woz', name: 'ä¸Šæµ·', nameEn: 'Shanghai', year: '1987', type: 'game', desc: 'éº»å°‡æ¥é¾ç›Šæ™ºéŠæˆ²ã€‚ç²¾ç¾çš„ä¸­åœ‹é¢¨æ ¼åœ–å½¢ã€‚', developer: 'Activision', publisher: 'Activision' },
            { id: 'wozaday_Battle_Chess_IIgs', file: '00playable.woz', name: 'æˆ°é¬¥è¥¿æ´‹æ£‹', nameEn: 'Battle Chess', year: '1989', type: 'game', desc: 'å‰µæ–°è¥¿æ´‹æ£‹éŠæˆ²ã€‚æ¯æ¬¡åƒå­éƒ½æœ‰ç²¾ç¾çš„æˆ°é¬¥å‹•ç•«ã€‚', developer: 'Interplay', publisher: 'Interplay' },
            { id: 'wozaday_Pipe_Dream_IIgs', file: '00playable.woz', name: 'æ°´ç®¡å¤¢', nameEn: 'Pipe Dream', year: '1990', type: 'game', desc: 'å‰µæ–°çš„ç›Šæ™ºéŠæˆ²ã€‚ç©å®¶å¿…é ˆåœ¨æ™‚é–“é™åˆ¶å…§,ç”¨ç®¡é“é€£æ¥èµ·é»å’Œçµ‚é»ã€‚', developer: 'The Assembly Line', publisher: 'LucasArts' },
            { id: 'wozaday_Tetris_IIgs', file: 'Tetris_IIgs.2mg', name: 'ä¿„ç¾…æ–¯æ–¹å¡Š', nameEn: 'Tetris', year: '1988', type: 'game', desc: 'æ°¸æ†çš„ç¶“å…¸ç›Šæ™ºéŠæˆ²ã€‚æ§åˆ¶ä¸‹è½çš„æ–¹å¡Š,æ—‹è½‰ä¸¦æ’åˆ—æˆå®Œæ•´çš„æ©«åˆ—ä¾†æ¶ˆé™¤ã€‚', developer: 'Alexey Pajitnov', publisher: 'Spectrum HoloByte' },

            // === æ¨¡æ“¬/ç­–ç•¥éŠæˆ² ===
            { id: 'wozaday_Defender_of_the_Crown_IIgs', file: '00playable.woz', name: 'ä¿çš‡é¨å£«', nameEn: 'Defender of the Crown', year: '1988', type: 'game', desc: 'Cinemaware ä»£è¡¨ä½œã€‚ä¸­ä¸–ç´€è‹±æ ¼è˜­æ•…äº‹ã€‚', developer: 'Cinemaware', publisher: 'Cinemaware' },
            { id: 'a2gs_Destroyer_1987_Epyx', file: 'Destroyer_1987_Epyx.2mg', name: 'é©…é€è‰¦', nameEn: 'Destroyer', year: '1987', type: 'game', desc: 'äºŒæˆ°æµ·æˆ°æ¨¡æ“¬éŠæˆ²ã€‚ç©å®¶æŒ‡æ®é©…é€è‰¦åœ¨å¤ªå¹³æ´‹æˆ°å ´ä¸ŠåŸ·è¡Œå„ç¨®ä»»å‹™ã€‚', developer: 'Epyx', publisher: 'Epyx' },

            // === æ•™è‚²è»Ÿé«” ===
            { id: 'wozaday_Charlie_Browns_ABCs_IIgs', file: 'Charlie_Browns_ABCs_IIgs.2mg', name: 'æŸ¥ç†å¸ƒæœ—å­—æ¯å­¸ç¿’', nameEn: "Charlie Brown's ABCs", year: '1990', type: 'edu', desc: 'ä»¥å²åŠªæ¯”æ¼«ç•«ç‚ºä¸»é¡Œçš„å…’ç«¥æ•™è‚²è»Ÿé«”ã€‚', developer: 'Random House', publisher: 'Random House' },
            { id: 'wozaday_The_New_Talking_Stickybear_Alphabet_IIgs', file: 'The_New_Talking_Stickybear_Alphabet_IIgs.2mg', name: 'æœƒèªªè©±çš„å­—æ¯ç†Š', nameEn: 'Talking Stickybear Alphabet', year: '1988', type: 'edu', desc: 'äº’å‹•å¼å­—æ¯å­¸ç¿’è»Ÿé«”ã€‚', developer: 'Optimum Resource', publisher: 'Optimum Resource' },

            // === å·¥å…·è»Ÿé«” ===
            { id: 'wozaday_List_Plus_IIgs', file: 'List_Plus_IIgs.2mg', name: 'List Plus', nameEn: 'List Plus', year: '1989', type: 'tool', desc: 'Beagle Bros å‡ºå“çš„ç¨‹å¼é–‹ç™¼å·¥å…·ã€‚', developer: 'Beagle Bros', publisher: 'Beagle Bros' },

            // === ç‰¹åˆ¥æ”¶è— ===
            { id: 'TotalReplay', file: 'TotalReplay.2mg', name: 'Total Replay (100æ¬¾åˆé›†)', nameEn: 'Total Replay', year: '2024', type: 'special', desc: 'åŒ…å« 100 æ¬¾ç²¾é¸ Apple II éŠæˆ²çš„çµ‚æ¥µåˆé›†ã€‚', developer: 'ç¤¾ç¾¤æ•´ç†', publisher: '4am' },
            { id: 'PitchDark', file: 'PitchDark.2mg', name: 'Pitch Dark (æ¼†é»‘)', nameEn: 'Pitch Dark', year: '2023', type: 'special', desc: 'ç¾ä»£å¾©åˆ»ç‰ˆçš„ Infocom é¢¨æ ¼æ–‡å­—å†’éšªéŠæˆ²ã€‚', developer: 'ç¤¾ç¾¤è£½ä½œ', publisher: 'Interactive Fiction' }
        ];

        function waitForEmularity() {
            return new Promise((resolve, reject) => {
                const check = () => {
                    if (typeof window.Emulator !== 'undefined' && typeof window.JSMAMELoader !== 'undefined' && typeof window.BrowserFS !== 'undefined') {
                        console.log('âœ… Emularity å°±ç·’ï¼');
                        emularityReady = true;
                        resolve();
                    } else if (Date.now() - Date.now() > 20000) {
                        reject(new Error('é€¾æ™‚'));
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }

        window.addEventListener('load', async () => {
            console.log('â³ ç­‰å¾… Emularity...');
            try {
                await waitForEmularity();
                console.log('âœ… åˆå§‹åŒ–å®Œæˆï¼\n');
            } catch (err) {
                console.error('âŒ å¤±æ•—:', err);
            }
        });

        async function loadGame(game, itemElement) {
            console.log(`\n======== è¼‰å…¥: ${game.name} ========`);

            // æ¸…ç†ä¹‹å‰çš„æ¨¡æ“¬å™¨å¯¦ä¾‹
            if (currentEmulator) {
                console.log('ğŸ§¹ æ¸…ç†ä¹‹å‰çš„æ¨¡æ“¬å™¨å¯¦ä¾‹...');
                try {
                    currentEmulator.stop();
                    currentEmulator = null;
                } catch (err) {
                    console.warn('æ¸…ç†æ¨¡æ“¬å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', err);
                }
            }

            // éš±è—ä½¿ç”¨æç¤ºè¦†è“‹å±¤
            document.getElementById('usageOverlay').classList.add('hidden');

            document.querySelectorAll('.game-item').forEach(el => el.classList.remove('active'));
            itemElement.classList.add('active');

            welcomeScreen.style.display = 'none';
            emulatorContainer.classList.add('active');

            // é‡ç½®ç¸®æ”¾
            currentZoom = 1.0;
            updateCanvasZoom();

            gameTitleBar.textContent = `${game.name} - è¼‰å…¥ä¸­...`;

            gameDescription.textContent = game.desc;
            gameDetails.innerHTML = `
                <li><strong>å¹´ä»½:</strong> ${game.year}</li>
                <li><strong>é–‹ç™¼å•†:</strong> ${game.developer}</li>
                <li><strong>ç™¼è¡Œå•†:</strong> ${game.publisher}</li>
                <li><strong>é¡å‹:</strong> ${game.type === 'game' ? 'éŠæˆ²' : game.type === 'edu' ? 'æ•™è‚²è»Ÿé«”' : game.type === 'tool' ? 'å·¥å…·è»Ÿé«”' : 'ç‰¹åˆ¥æ”¶è—'}</li>
            `;

            archiveBtn.onclick = () => window.open(`https://archive.org/details/${game.id}`, '_blank');

            try {
                if (!emularityReady) await waitForEmularity();

                console.log('âœ… Emularity å°±ç·’');
                console.log('\nâ³ åˆå§‹åŒ– MAME...');

                const canvas = document.getElementById('canvas');

                // â­ ä½¿ç”¨å¾Œç«¯ä»£ç† URL
                const mameJsUrl = `${SERVER_URL}/proxy/mame/mameapple2gs.js.gz`;
                const mameWasmUrl = `${SERVER_URL}/proxy/mame/mameapple2gs.wasm.gz`;
                const biosUrl = `${SERVER_URL}/proxy/bios/apple2gs.zip`;
                const gameUrl = `${SERVER_URL}/proxy/game/${game.id}/${game.file}`;

                console.log('\nğŸ“¦ ä½¿ç”¨å¾Œç«¯ä»£ç†:');
                console.log('   - MAME JS:', mameJsUrl);
                console.log('   - MAME WASM:', mameWasmUrl);
                console.log('   - BIOS:', biosUrl);
                console.log('   - éŠæˆ²:', gameUrl);
                console.log('\nâ­ æ›è¼‰åˆ° emulator/ ç›®éŒ„');

                // æª¢æŸ¥æ˜¯å¦æœ‰ç¬¬äºŒç‰‡ç£ç‰‡
                const extraArgs = game.file2 
                    ? ['-flop3', '/emulator/' + game.file, '-flop4', '/emulator/' + game.file2]
                    : ['-flop3', '/emulator/' + game.file];

                const emulator = new window.Emulator(
                    canvas,
                    null,
                    new window.JSMAMELoader(
                        window.JSMAMELoader.driver('apple2gs'),
                        window.JSMAMELoader.nativeResolution(880, 580),
                        window.JSMAMELoader.emulatorJS(mameJsUrl),
                        window.JSMAMELoader.emulatorWASM(mameWasmUrl),
                        window.JSMAMELoader.extraArgs(extraArgs),
                        window.JSMAMELoader.mountFile(game.file, window.JSMAMELoader.fetchFile('Game Disk', gameUrl)),
                        game.file2 ? window.JSMAMELoader.mountFile(game.file2, window.JSMAMELoader.fetchFile('Game Disk 2', `${SERVER_URL}/proxy/game/${game.id}/${game.file2}`)) : null,
                        window.JSMAMELoader.mountFile('apple2gs.zip', window.JSMAMELoader.fetchFile('BIOS', biosUrl))
                    )
                );

                // ä¿å­˜ç•¶å‰æ¨¡æ“¬å™¨å¯¦ä¾‹
                currentEmulator = emulator;

                console.log('âœ… å¯¦ä¾‹å»ºç«‹æˆåŠŸ');
                console.log('â³ å•Ÿå‹•...');

                emulator.start({ waitAfterDownloading: true });

                setTimeout(() => {
                    if (document.getElementById('loadingTip')) {
                        document.getElementById('loadingTip').classList.add('hidden');
                    }
                    document.getElementById('usageOverlay').classList.remove('hidden');
                }, 3000);

                const hideOverlay = () => {
                    document.getElementById('usageOverlay').classList.add('hidden');
                    console.log('âœ… ä½¿ç”¨è€…äº’å‹•');
                };
                canvas.addEventListener('click', hideOverlay, { once: true });
                document.getElementById('usageOverlay').addEventListener('click', hideOverlay, { once: true });

                gameTitleBar.textContent = `${game.name} (${game.nameEn})`;
                console.log(`âœ… æˆåŠŸ: ${game.name}`);
                console.log('ğŸ”Š è²éŸ³æ­£å¸¸ï¼');
                console.log('========\n');

            } catch (err) {
                console.error('âŒ å¤±æ•—:', err);
                gameTitleBar.textContent = `${game.name} - å¤±æ•—`;
                alert(`å¤±æ•—ï¼š\n\n${err.message}`);
            }

            currentGame = game;
        }

        function renderGames(filter = '') {
            gameList.innerHTML = '';
            const filtered = games.filter(g =>
                g.name.includes(filter) ||
                g.nameEn.toLowerCase().includes(filter.toLowerCase())
            );

            filtered.forEach(game => {
                const item = document.createElement('div');
                item.className = 'game-item';
                item.dataset.id = game.id;
                item.innerHTML = `
                    <h3>${game.name} ${getBadge(game.type)}</h3>
                    <div class="name-en">${game.nameEn}</div>
                    <div class="year">ğŸ“… ${game.year}</div>
                `;
                item.onclick = () => loadGame(game, item);
                gameList.appendChild(item);
            });
        }

        fullscreenBtn.onclick = () => {
            if (!isFullscreen) {
                // é€²å…¥å…¨è¢å¹•æ¨¡å¼
                const elem = document.documentElement; // ä½¿ç”¨æ•´å€‹ document

                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            } else {
                // é€€å‡ºå…¨è¢å¹•æ¨¡å¼
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        };

        document.addEventListener('fullscreenchange', updateFullscreenStatus);
        document.addEventListener('webkitfullscreenchange', updateFullscreenStatus);
        document.addEventListener('mozfullscreenchange', updateFullscreenStatus);
        document.addEventListener('MSFullscreenChange', updateFullscreenStatus);

        function updateFullscreenStatus() {
            isFullscreen = !!(document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement);

            fullscreenBtn.innerHTML = isFullscreen ? 'â›¶ é€€å‡ºå…¨è¢å¹•' : 'â›¶ å…¨è¢å¹•';

            // åœ¨å…¨è¢å¹•æ¨¡å¼ä¸‹éš±è—å…¶ä»–å…ƒç´ 
            const header = document.querySelector('.header');
            const sidebar = document.querySelector('.sidebar');
            const leftResizer = document.querySelector('#leftResizer');
            const emulatorControls = document.querySelector('.emulator-controls');
            const rightResizer = document.querySelector('#rightResizer');
            const infoPanel = document.querySelector('.info-panel');

            if (isFullscreen) {
                // é€²å…¥å…¨è¢å¹•ï¼šéš±è—ä¸éœ€è¦çš„å…ƒç´ 
                if (header) header.style.display = 'none';
                if (sidebar) sidebar.style.display = 'none';
                if (leftResizer) leftResizer.style.display = 'none';
                if (emulatorControls) emulatorControls.style.display = 'none';
                if (rightResizer) rightResizer.style.display = 'none';
                if (infoPanel) infoPanel.style.display = 'none';

                // è®“ canvas å¡«æ»¿æ•´å€‹è¢å¹•
                const canvas = document.querySelector('#canvas');
                if (canvas) {
                    canvas.style.position = 'fixed';
                    canvas.style.top = '0';
                    canvas.style.left = '0';
                    canvas.style.width = '100vw';
                    canvas.style.height = '100vh';
                    canvas.style.zIndex = '9999';
                    canvas.style.border = 'none';
                }
            } else {
                // é€€å‡ºå…¨è¢å¹•ï¼šæ¢å¾©æ­£å¸¸é¡¯ç¤º
                if (header) header.style.display = '';
                if (sidebar) sidebar.style.display = '';
                if (leftResizer) leftResizer.style.display = '';
                if (emulatorControls) emulatorControls.style.display = '';
                if (rightResizer) rightResizer.style.display = '';
                if (infoPanel) infoPanel.style.display = '';

                // æ¢å¾© canvas æ­£å¸¸æ¨£å¼
                const canvas = document.querySelector('#canvas');
                if (canvas) {
                    canvas.style.position = '';
                    canvas.style.top = '';
                    canvas.style.left = '';
                    canvas.style.width = '';
                    canvas.style.height = '';
                    canvas.style.zIndex = '';
                    canvas.style.border = '';
                }
            }
        }

        reloadBtn.onclick = () => {
            if (currentGame) {
                // æ¸…ç†ä¹‹å‰çš„æ¨¡æ“¬å™¨å¯¦ä¾‹
                if (currentEmulator) {
                    console.log('ğŸ”„ é‡æ–°è¼‰å…¥ï¼šæ¸…ç†ä¹‹å‰çš„æ¨¡æ“¬å™¨å¯¦ä¾‹...');
                    try {
                        currentEmulator.stop();
                        currentEmulator = null;
                    } catch (err) {
                        console.warn('æ¸…ç†æ¨¡æ“¬å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', err);
                    }
                }
                loadGame(currentGame, document.querySelector('.game-item.active'));
            }
        };

        searchBox.addEventListener('input', (e) => {
            renderGames(e.target.value);
        });

        leftResizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        });

        rightResizer.addEventListener('mousedown', (e) => {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = infoPanel.offsetWidth;

            function onMouseMove(e) {
                const diff = startX - e.clientX;
                const newWidth = startWidth + diff;
                if (newWidth >= 250 && newWidth <= 500) {
                    infoPanel.style.width = newWidth + 'px';
                }
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            const newWidth = e.clientX;
            if (newWidth >= 250 && newWidth <= 500) {
                sidebar.style.width = newWidth + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        renderGames();
        document.getElementById('totalCount').textContent = games.length;
        console.log(`âœ… å·²è¼‰å…¥ ${games.length} æ¬¾ Apple IIgs è»Ÿé«”`);
    </script>
</body>

</html>